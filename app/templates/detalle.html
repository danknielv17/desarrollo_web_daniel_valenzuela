<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Información de la Actividad</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/detalle.css') }}">
</head>
<body>
<header>
    <h1>Información de la Actividad Seleccionada</h1>
</header>

<main>
    <div class="detalle">
        <h2>Actividad</h2>

        <p><strong>Inicio:</strong> {{ actividad.dia_hora_inicio.strftime('%Y-%m-%d %H:%M') }}</p>
        <p><strong>Término:</strong> {{ actividad.dia_hora_termino.strftime('%Y-%m-%d %H:%M') if actividad.dia_hora_termino else '-' }}</p>
        <p><strong>Comuna:</strong> {{ actividad.comuna.nombre if actividad.comuna_id else '-' }}</p>
        <p><strong>Sector:</strong> {{ actividad.sector or '-' }}</p>
        <p><strong>Descripción:</strong> {{ actividad.descripcion or '-' }}</p>
        <p><strong>Organizador:</strong> {{ actividad.nombre }}</p>
        <p><strong>Email:</strong> {{ actividad.email }}</p>
        <p><strong>Teléfono:</strong> {{ actividad.celular or '-' }}</p>

        {% if temas_obj %}
        <h3>Temas asociados</h3>
        <ul>
            {% for tema_obj in temas_obj %}
                <li>
                    {% if tema_obj.tema == 'otro' and tema_obj.glosa_otro %}
                        {{ tema_obj.glosa_otro }}
                    {% else %}
                        {{ tema_obj.tema }}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if contactos %}
        <h3>Contacto</h3>
        <ul>
            {% for c in contactos %}
                <li><strong>{{ c.nombre }}:</strong> {{ c.identificador }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if archivos %}
        <h3>Fotos de la Actividad</h3>
        <div class="galeria">
            {% for archivo in archivos %}
            <img src="{{ url_for('static', filename='uploads/' + archivo.nombre_archivo) }}"
                 alt="Foto de la actividad"
                 width="320" height="240"
                 style="cursor:pointer"
                 onclick="ampliarFoto('{{ url_for('static', filename='uploads/' + archivo.nombre_archivo) }}')"
                 onerror="this.onerror=null; this.src='{{ url_for('static', filename='img/no-image.png') }}';">
            {% endfor %}
        </div>
        {% endif %}

        <section id="comentarios">
            <h3> Agregar Comentario</h3>
            <form id="form-comentario" data-id="{{ actividad.id }}">
                <label for="nombre-comentario">Nombre:</label>
                <input type="text" id="nombre-comentario" name="nombre" required minlength="3" maxlength="80">

                <label for="texto-comentario">Comentario:</label>
                <textarea id="texto-comentario" name="texto" rows="4" cols="50" required minlength="5" maxlength="300"></textarea>

                <button type="submit">Agregar comentario</button>
                <div id="errores-comentario" style="color:red"></div>
            </form>
            <h3>Listado de Comentarios</h3>
            <ul id="lista-comentarios"></ul>
        </section>

        <div class="botones-navegacion">
            <a href="{{ url_for('listado') }}"><button type="button">Volver al Listado</button></a>
            <a href="{{ url_for('portada') }}"><button type="button">Volver a la Portada</button></a>
        </div>
    </div>
</main>

<!-- Exponer token CSRF al frontend -->
<script>
    const csrfToken = "{{ csrf_token() }}";
</script>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
